<!DOCTYPE html>
<html>
<head>
    <title>Estate V64 - Gold & Radio</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 10px; border-left: 5px solid #f1c40f; pointer-events: none; }
        #credit { position: absolute; bottom: 10px; left: 10px; color: rgba(255,255,255,0.5); font-size: 12px; }
        #tipBox { position: absolute; top: 10px; right: 10px; pointer-events: auto; }
        #overlay { position: absolute; width: 100%; height: 100%; background: #111; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn { padding: 15px 40px; font-size: 20px; cursor: pointer; background: #f1c40f; border: none; color: #000; font-weight: bold; border-radius: 5px; }
        #msg { position: absolute; top: 40%; width: 100%; text-align: center; color: #f1c40f; font-size: 28px; font-weight: bold; opacity: 0; transition: opacity 0.5s; pointer-events: none; }
        #radioDisplay { color: #2ecc71; font-weight: bold; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>ESTATE V64</h1>
        <p>Verified Receipt: DEV-MWUNR0XT6-100</p>
        <button class="btn" onclick="start()">START ENGINE</button>
    </div>

    <div id="ui">
        <b>W / S</b>: Forward / Back | <b>A / D</b>: Turn<br>
        <b>M</b>: Cycle Radio Stations<br>
        <b>Radio</b>: <span id="radioDisplay">OFF</span>
        <hr>
        Action: <span id="action" style="color:#f1c40f">IDLE</span>
    </div>

    <div id="tipBox">
        <button style="padding:10px; cursor:pointer;" onclick="sendTip()">ðŸ’° TIP</button>
    </div>

    <div id="credit">Code Logic provided to Google Gemini</div>
    <div id="msg"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, car, carBody, audioCtx, oscillator;
        let objects = [], buildableSurface = [], keyStack = [];
        let playerYaw = 0, playerPitch = 0, vy = 0, isJumping = false, isDriving = false;
        let radioStation = 0;

        function start() {
            document.getElementById('overlay').style.display = 'none';
            init();
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting for Gold (Needs brightness to reflect)
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(5, 20, 10);
            scene.add(sun);

            const floor = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x27ae60}));
            floor.rotation.x = -Math.PI/2; 
            scene.add(floor); 
            buildableSurface.push(floor);

            createVillage();
            createCar();

            window.addEventListener('keydown', e => {
                if (!keyStack.includes(e.code)) keyStack.push(e.code);
                if (e.code === 'KeyM') cycleRadio();
                if (e.code === 'KeyE') isDriving = !isDriving;
                if (e.code === 'Space' && !isJumping) { vy = 0.5; isJumping = true; }
            });
            window.addEventListener('keyup', e => keyStack = keyStack.filter(k => k !== e.code));

            loop();
        }

        function createCar() {
            car = new THREE.Group();
            // FIXED GOLD: Higher metalness, lower roughness, and color #FFD700
            carBody = new THREE.Mesh(
                new THREE.BoxGeometry(4, 2, 7), 
                new THREE.MeshStandardMaterial({
                    color: 0xFFD700, 
                    metalness: 0.9, 
                    roughness: 0.1,
                    emissive: 0x332200 // Slight glow to prevent turning "black"
                })
            );
            carBody.position.y = 1; car.add(carBody);
            car.position.set(10, 0, 10);
            scene.add(car);
            objects.push(carBody);
        }

        function cycleRadio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (oscillator) oscillator.stop();

            radioStation = (radioStation + 1) % 4;
            const stations = ["OFF", "80s Synth", "Lo-Fi Hum", "Heavy Bass"];
            document.getElementById('radioDisplay').innerText = stations[radioStation];

            if (radioStation > 0) {
                oscillator = audioCtx.createOscillator();
                let gain = audioCtx.createGain();
                
                const freqs = [0, 110, 55, 30];
                const types = ['sine', 'square', 'sawtooth', 'triangle'];
                
                oscillator.type = types[radioStation];
                oscillator.frequency.setValueAtTime(freqs[radioStation], audioCtx.currentTime);
                
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                oscillator.connect(gain);
                gain.connect(audioCtx.destination);
                oscillator.start();
            }
        }

        function createVillage() {
            for(let i=0; i<3; i++) {
                const h = new THREE.Mesh(new THREE.BoxGeometry(10, 10, 10), new THREE.MeshStandardMaterial({color: 0x7f8c8d}));
                h.position.set(-20, 5, i * -25);
                scene.add(h);
                objects.push(h);
            }
        }

        function loop() {
            requestAnimationFrame(loop);
            const topKey = keyStack[keyStack.length - 1];
            document.getElementById('action').innerText = topKey || "IDLE";

            const speed = 0.5;
            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            dir.y = 0; dir.normalize();

            if (topKey === 'KeyW') {
                if(isDriving) car.position.add(dir.clone().multiplyScalar(speed * 2));
                else camera.position.add(dir.clone().multiplyScalar(speed));
            } 
            else if (topKey === 'KeyS') {
                if(isDriving) car.position.sub(dir.clone().multiplyScalar(speed * 2));
                else camera.position.sub(dir.clone().multiplyScalar(speed));
            } 
            else if (topKey === 'KeyA') playerYaw += 0.04;
            else if (topKey === 'KeyD') playerYaw -= 0.04;
            else if (topKey === 'ArrowUp') playerPitch = Math.min(playerPitch + 0.04, 1.5);
            else if (topKey === 'ArrowDown') playerPitch = Math.max(playerPitch - 0.04, -1.5);

            // Gravity
            if(!isDriving) {
                camera.position.y += vy;
                if(isJumping) vy -= 0.025;
                if(camera.position.y <= 5) { camera.position.y = 5; vy = 0; isJumping = false; }
            }

            // Sync
            if(isDriving) {
                car.rotation.y = playerYaw - Math.PI;
                camera.position.set(car.position.x - Math.sin(playerYaw)*12, car.position.y + 6, car.position.z - Math.cos(playerYaw)*12);
                camera.lookAt(car.position);
            } else {
                camera.rotation.order = 'YXZ';
                camera.rotation.y = playerYaw;
                camera.rotation.x = playerPitch;
            }

            renderer.render(scene, camera);
        }

        function sendTip() {
            let amount = prompt("Tip the Devs? ($)");
            if(amount) alert("Receipt Generated! (Use DEV-MWUNR0XT6-100)");
        }
    </script>
</body>
</html>
