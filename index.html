<!DOCTYPE html>
<html>
<head>
    <title>Estate V74 - Diamond Hypercar</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; }
        #overlay { position: absolute; width: 100%; height: 100%; background: #000; color: #B9F2FF; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #ui { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; border-left: 4px solid #B9F2FF; pointer-events: none; }
        
        #djDeck { position: absolute; bottom: 20px; right: 20px; background: #111; padding: 15px; border-radius: 10px; border: 2px solid #B9F2FF; color: #fff; width: 300px; z-index: 10; }
        #djDeck input { width: 92%; padding: 8px; margin-bottom: 10px; background: #000; color: #B9F2FF; border: 1px solid #333; }
        #playerFrame { width: 100%; height: 120px; background: #000; border: none; display: none; margin-top: 10px; }
        
        #controlPanel { position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 10px; }
        .btn { padding: 10px 20px; background: #B9F2FF; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; color: #000; transition: 0.3s; }
        .btn:hover { background: #fff; box-shadow: 0 0 15px #B9F2FF; }
        .stealth-locked { background: #333; color: #666; cursor: not-allowed; }
        
        #credit { position: absolute; bottom: 10px; left: 10px; color: rgba(255,255,255,0.3); font-size: 10px; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="letter-spacing: 5px;">ESTATE V74</h1>
        <p>DIAMOND HYPERCAR INITIALIZED</p>
        <button class="btn" style="font-size:20px; padding: 15px 40px;" onclick="startEngine()">IGNITION</button>
    </div>

    <div id="ui">
        <b>WASD</b>: Drive | <b>SPACE</b>: Brake<br>
        <b>Model</b>: Diamond X-74<br>
        <b>Condition</b>: <span id="carStatus" style="color:#B9F2FF">SHINING</span>
    </div>

    <div id="controlPanel">
        <button class="btn" onclick="processTip()">ðŸ’° TIP $100 / ENTER RECEIPT</button>
        <button id="stealthBtn" class="btn stealth-locked" onclick="toggleStealth()">ðŸ‘» STEALTH: LOCKED</button>
    </div>

    <div id="djDeck">
        <b>ðŸŽµ DJ LINK DECK</b><br>
        <input type="text" id="musicLink" placeholder="Paste YouTube Link...">
        <button class="btn" style="width:100%" onclick="playLink()">â–¶ PLAY MUSIC</button>
        <iframe id="playerFrame" allow="autoplay"></iframe>
    </div>

    <div id="credit">Code Logic: Google Gemini | Receipt: DEV-MWUNR0XT6-100</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, carGroup, chassis, cabin, spoiler;
        let keyStack = [], playerYaw = 0, speed = 0, isStealth = false, hasUnlocked = false;

        function startEngine() {
            document.getElementById('overlay').style.display = 'none';
            init();
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020205);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 8, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            document.body.appendChild(renderer.domElement);

            // Lighting for Diamond Shine
            scene.add(new THREE.AmbientLight(0xffffff, 0.3));
            const sun = new THREE.DirectionalLight(0xffffff, 1.2);
            sun.position.set(10, 20, 10);
            scene.add(sun);
            
            // Neon Floor Grid
            const grid = new THREE.GridHelper(1000, 80, 0xB9F2FF, 0x111111);
            scene.add(grid);

            createDiamondCar();

            window.addEventListener('keydown', e => { if(!keyStack.includes(e.code)) keyStack.push(e.code); });
            window.addEventListener('keyup', e => keyStack = keyStack.filter(k => k !== e.code));

            animate();
        }

        function createDiamondCar() {
            carGroup = new THREE.Group();

            // Diamond Material
            const diamondMat = new THREE.MeshStandardMaterial({
                color: 0xB9F2FF,
                metalness: 1.0,
                roughness: 0.1,
                emissive: 0x224466,
                emissiveIntensity: 0.2,
                transparent: true,
                opacity: 1.0
            });

            const glassMat = new THREE.MeshStandardMaterial({color: 0x000000, metalness: 1, roughness: 0, transparent: true, opacity: 1});

            // Body Parts
            chassis = new THREE.Mesh(new THREE.BoxGeometry(4.5, 0.8, 9), diamondMat);
            chassis.position.y = 0.5; carGroup.add(chassis);

            cabin = new THREE.Mesh(new THREE.BoxGeometry(3, 1, 4.5), glassMat);
            cabin.position.set(0, 1.2, -0.5); carGroup.add(cabin);

            spoiler = new THREE.Mesh(new THREE.BoxGeometry(4.5, 0.1, 1.5), diamondMat);
            spoiler.position.set(0, 1.5, 3.5); carGroup.add(spoiler);

            // Wheels
            const wGeo = new THREE.CylinderGeometry(0.8, 0.8, 0.6, 24);
            const wMat = new THREE.MeshStandardMaterial({color: 0x111111});
            for(let i=0; i<4; i++) {
                const w = new THREE.Mesh(wGeo, wMat);
                w.rotation.z = Math.PI/2;
                w.position.set(i<2 ? 2.3 : -2.3, 0.5, i%2==0 ? 2.8 : -2.8);
                carGroup.add(w);
            }

            scene.add(carGroup);
        }

        function processTip() {
            let input = prompt("Enter Tip Amount ($) or Receipt Code:");
            if (parseInt(input) >= 100 || input === "DEV-MWUNR0XT6-100") {
                hasUnlocked = true;
                const btn = document.getElementById('stealthBtn');
                btn.className = "btn";
                btn.innerText = "ðŸ‘» STEALTH: OFF";
                alert("ULTRA-TECH UNLOCKED: Stealth Mode is now available!");
            }
        }

        function toggleStealth() {
            if (!hasUnlocked) return;
            isStealth = !isStealth;
            const targetOpacity = isStealth ? 0.05 : 1.0;
            const status = document.getElementById('carStatus');
            const btn = document.getElementById('stealthBtn');

            [chassis, cabin, spoiler].forEach(part => {
                part.material.opacity = targetOpacity;
            });

            status.innerText = isStealth ? "GHOST MODE" : "SHINING";
            status.style.color = isStealth ? "#555" : "#B9F2FF";
            btn.innerText = isStealth ? "ðŸ‘» STEALTH: ON" : "ðŸ‘» STEALTH: OFF";
        }

        function playLink() {
            let url = document.getElementById('musicLink').value;
            let frame = document.getElementById('playerFrame');
            let videoId = "";
            if (url.includes("v=")) videoId = url.split("v=")[1].split("&")[0];
            else if (url.includes("youtu.be/")) videoId = url.split("youtu.be/")[1];

            if (videoId) {
                frame.style.display = "block";
                frame.src = "https://www.youtube.com/embed/" + videoId + "?autoplay=1";
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            const topKey = keyStack[keyStack.length - 1];
            
            if (topKey === 'KeyW') speed = Math.min(speed + 0.03, 1.2);
            else if (topKey === 'KeyS') speed = Math.max(speed - 0.03, -0.6);
            else speed *= 0.97;

            if (topKey === 'KeyA') playerYaw += 0.045;
            if (topKey === 'KeyD') playerYaw -= 0.045;

            carGroup.rotation.y = playerYaw - Math.PI;
            carGroup.position.x -= Math.sin(playerYaw) * speed;
            carGroup.position.z -= Math.cos(playerYaw) * speed;

            camera.position.set(carGroup.position.x + Math.sin(playerYaw)*14, carGroup.position.y + 7, carGroup.position.z + Math.cos(playerYaw)*14);
            camera.lookAt(carGroup.position);

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
