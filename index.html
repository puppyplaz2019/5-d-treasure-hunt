<!DOCTYPE html>
<html>
<head>
    <title>3D Cave - Pro Version</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #ui { 
            position: absolute; top: 10px; left: 10px; 
            color: #00ff00; font-family: monospace; pointer-events: none; 
            background: rgba(0,0,0,0.8); padding: 15px; border: 2px solid #333;
        }
    </style>
</head>
<body>
    <div id="ui">
        <h1>CAVE_EXPLORER_V3</h1>
        <p>WASD: Move | Arrows: Look Around</p>
        <p id="dist">DISTANCE: SCANNING...</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x000000, 1, 10);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Materials
        const caveMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });

        // 1. THE TUNNEL (Floor, Ceiling, and Walls)
        const planeGeo = new THREE.PlaneGeometry(8, 100); // Narrower tunnel
        
        const floor = new THREE.Mesh(planeGeo, caveMat);
        floor.rotation.x = -Math.PI/2;
        floor.position.y = -1;
        scene.add(floor);

        const ceiling = new THREE.Mesh(planeGeo, caveMat);
        ceiling.rotation.x = Math.PI/2;
        ceiling.position.y = 2;
        scene.add(ceiling);

        const wallGeo = new THREE.PlaneGeometry(100, 3);
        const leftWall = new THREE.Mesh(wallGeo, caveMat);
        leftWall.rotation.y = Math.PI/2;
        leftWall.position.x = -4;
        scene.add(leftWall);

        const rightWall = new THREE.Mesh(wallGeo, caveMat);
        rightWall.rotation.y = -Math.PI/2;
        rightWall.position.x = 4;
        scene.add(rightWall);

        // 2. THE TREASURE
        const treasure = new THREE.Mesh(
            new THREE.OctahedronGeometry(0.4),
            new THREE.MeshStandardMaterial({ color: 0xFFD700, emissive: 0xffaa00 })
        );
        treasure.position.set(0, 0, -10);
        scene.add(treasure);

        // 3. LIGHTS
        const flashlight = new THREE.PointLight(0xffffff, 2, 12);
        scene.add(flashlight);
        scene.add(new THREE.AmbientLight(0x111111));

        // 4. PLAYER LOGIC
        let keys = {};
        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        let rotation = 0;
        camera.position.z = 5;

        function animate() {
            requestAnimationFrame(animate);

            // Rotation (Look Around)
            if (keys['ArrowLeft']) rotation += 0.03;
            if (keys['ArrowRight']) rotation -= 0.03;
            camera.rotation.y = rotation;

            // Movement relative to where you are looking
            const speed = 0.1;
            if (keys['KeyW']) {
                camera.position.x -= Math.sin(rotation) * speed;
                camera.position.z -= Math.cos(rotation) * speed;
            }
            if (keys['KeyS']) {
                camera.position.x += Math.sin(rotation) * speed;
                camera.position.z += Math.cos(rotation) * speed;
            }

            // SIMPLE COLLISION (Stay inside walls)
            if (camera.position.x > 3.5) camera.position.x = 3.5;
            if (camera.position.x < -3.5) camera.position.x = -3.5;

            // Light follows player
            flashlight.position.copy(camera.position);
            treasure.rotation.y += 0.02;

            const d = camera.position.distanceTo(treasure.position);
            document.getElementById('dist').innerText = "DIST: " + d.toFixed(1) + "m";

            if(d < 0.8) {
                alert("ðŸ’Ž TREASURE SECURED!");
                treasure.position.z -= 15; // Move it further down the cave
                treasure.position.x = (Math.random() * 6) - 3;
            }

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
